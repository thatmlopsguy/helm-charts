# Default values for global chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Override chart and release names
nameOverride: ""
fullnameOverride: ""

# Additional labels to apply to all resources
labels: {}

# Namespace to deploy to (defaults to release namespace)
namespace: ""

# Multiple deployments configuration
# This allows deploying multiple applications from a single chart
# Each deployment MUST have its own image configuration
deployments: #{}
  # Example configuration:
  frontend:
    enabled: true
    replicaCount: 2
    image:
      registry: ""           # Optional: container registry
      repository: nginx      # Required: image repository
      tag: "1.21.6"         # Required: image tag
      pullPolicy: IfNotPresent
    ports:
      - name: http
        containerPort: 80
        protocol: TCP
    service:
      enabled: true
      type: ClusterIP        # ClusterIP, NodePort, LoadBalancer, ExternalName
      ports:
        - name: http
          port: 80
          targetPort: http
          protocol: TCP
      annotations: {}
    ingress:
      enabled: true
      className: ""          # Ingress class (e.g., nginx, traefik)
      annotations: {}
        # kubernetes.io/ingress.class: nginx
        # kubernetes.io/tls-acme: "true"
        # nginx.ingress.kubernetes.io/rewrite-target: /
      hosts:
        - host: frontend.example.com
          paths:
            - path: /
              pathType: Prefix
              servicePort: 80
      tls: []
        # - secretName: frontend-tls
        #   hosts:
        #     - frontend.example.com
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
    livenessProbe:
      httpGet:
        path: /
        port: http
    readinessProbe:
      httpGet:
        path: /
        port: http

  backend:
    enabled: true
    replicaCount: 3
    image:
      repository: my-app/backend  # Required: each deployment needs its own image
      tag: "v1.0.0"             # Required: specific version for this deployment
    ports:
      - name: api
        containerPort: 8080
    service:
      enabled: true
      type: ClusterIP
      ports:
        - name: api
          port: 8080
          targetPort: api
          protocol: TCP
        - name: metrics
          port: 9090
          targetPort: 9090
          protocol: TCP
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9090"
    ingress:
      enabled: true
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/rewrite-target: /
        nginx.ingress.kubernetes.io/cors-allow-origin: "*"
      hosts:
        - host: api.example.com
          paths:
            - path: /api
              pathType: Prefix
              servicePort: 8080
        - host: backend.example.com
          paths:
            - path: /
              pathType: Prefix
              servicePort: 8080
      tls:
        - secretName: backend-tls
          hosts:
            - api.example.com
            - backend.example.com
    env:
      - name: DATABASE_URL
        value: "postgresql://..."

  # Example job configuration:
  # migration:
  #   enabled: true
  #   image:
  #     repository: myapp/migration
  #     tag: "v1.0.0"
  #   job:
  #     enabled: true
  #     restartPolicy: Never        # Never, OnFailure
  #     backoffLimit: 3             # Number of retries before marking job as failed
  #     activeDeadlineSeconds: 600  # Maximum duration for job execution
  #     ttlSecondsAfterFinished: 86400  # Clean up job after 24 hours
  #     command: ["python", "manage.py", "migrate"]
  #     annotations:
  #       helm.sh/hook: pre-install,pre-upgrade
  #       helm.sh/hook-weight: "1"
  #   env:
  #     - name: DATABASE_URL
  #       value: "postgresql://..."

# Global ingress configuration (optional)
# This can route traffic to multiple services from a single ingress
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: myapp.example.com
      paths:
        - path: /
          pathType: Prefix
          serviceName: frontend    # Reference to deployment name
          servicePort: 80
        - path: /api
          pathType: Prefix
          serviceName: backend     # Reference to deployment name
          servicePort: 8080
  tls: []
    # - secretName: myapp-tls
    #   hosts:
    #     - myapp.example.com

# Image pull secrets (applied to all deployments by default)
imagePullSecrets: []

# Service Account (used as default for all deployments)
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Global pod configuration (used as defaults for all deployments)
podAnnotations: {}
podLabels: {}

# Global security contexts (used as defaults for all deployments)
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 2000

containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
    - ALL

# Global resource defaults (can be overridden per deployment)
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Global node selection (can be overridden per deployment)
nodeSelector: {}

# Global tolerations (can be overridden per deployment)
tolerations: []

# Global affinity rules (can be overridden per deployment)
affinity: {}

# Global topology spread constraints
topologySpreadConstraints: []

# Global host aliases
hostAliases: []

# Global DNS configuration
dnsPolicy: ""
dnsConfig: {}

# Global priority class
priorityClassName: ""

# Global restart policy
restartPolicy: ""

# Global grace period for pod termination
terminationGracePeriodSeconds: 30
